@using MudBlazor
@using Microsoft.AspNetCore.Components
@using Mythetech.Framework.Infrastructure.Plugins.Components
@inherits PluginContextPanel
@attribute [PluginComponentMetadata(
    Icon = Icons.Material.Outlined.Games,
    Title = "Games",
    Order = 20)]

@if (selectedGame == null)
{
    <div class="d-flex flex-column gap-3" style="height: 100%;">
        <div class="pa-4">
            <MudText Typo="Typo.h6" Class="mb-4">Available Games</MudText>
            <div class="games-grid">
                @foreach (var game in availableGames)
                {
                    <div onclick="@(() => SelectGame(game))">
                        <MudCard Outlined="true" class="game-card pa-2" style="cursor: pointer;">
                            <div class="d-flex flex-column align-center text-center">
                                <MudIcon Icon="@game.Icon" Size="Size.Large" Color="Color.Primary" Class="mb-3" Style="font-size: 48px;" />
                                <MudText Typo="Typo.h6" Class="mb-2">@game.Name</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">@game.Description</MudText>
                            </div>
                        </MudCard>
                    </div>
                }
            </div>
        </div>
    </div>
}
else
{
    <div class="d-flex flex-column" style="height: 100%;">
        <div class="d-flex align-items-center gap-3 pa-3" style="border-bottom: 1px solid var(--mud-palette-divider);">
            <MudIconButton Icon="@Icons.Material.Rounded.ArrowBack"
                          Variant="Variant.Text"
                          Color="Color.Default"
                          OnClick="GoBack"
                          Class="rounded-md"
                          Title="Back to games" />
            <MudIcon Icon="@selectedGame.Icon" Size="Size.Small" />
            <MudText Typo="Typo.h6">@selectedGame.Name</MudText>
        </div>
        <div class="flex-grow-1" style="overflow: auto;">
            <DynamicComponent Type="selectedGame.ComponentType" />
        </div>
    </div>
}

<style>
    .align-items-center {
        align-items: center;
    }
    
    .games-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .game-card {
        transition: background-color 0.2s ease-in-out 0s;
        width: 100%;
    }
    .game-card:hover {
        background-color: var(--mud-palette-primary-hover);
    }
</style>

@code {
    public override string Icon { get; } = Icons.Material.Outlined.Games;
    public override string Title { get; } = "Games";

    private GameInfo? selectedGame;
    private readonly List<GameInfo> availableGames = new()
    {
        new GameInfo
        {
            Id = "breakout",
            Name = "Breakout",
            Description = "Classic brick-breaking game",
            Icon = Icons.Material.Outlined.SportsEsports,
            ComponentType = typeof(BreakoutGame)
        },
        new GameInfo
        {
            Id = "minesweeper",
            Name = "Minesweeper",
            Description = "Find all the mines without detonating them",
            Icon = "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\" width=\"24px\" fill=\"currentColor\"><path d=\"M346-48q-125 0-212.5-88.5T46-350q0-125 86.5-211.5T344-648h13l27-47q12-22 36-28.5t46 6.5l30 17 5-8q23-43 72-56t92 12l35 20-40 69-35-20q-14-8-30.5-3.5T570-668l-5 8 40 23q21 12 27.5 36t-5.5 45l-27 48q23 36 34.5 76.5T646-348q0 125-87.5 212.5T346-48Zm0-80q91 0 155.5-64.5T566-348q0-31-8.5-61T532-466l-26-41 42-72-104-60-42 72h-44q-94 0-163.5 60T125-350q0 92 64.5 157T346-128Zm454-480v-80h120v80H800ZM580-828v-120h80v120h-80Zm195 81-56-56 85-85 56 56-85 85ZM346-348Z\"/></svg>",
            ComponentType = typeof(MinesweeperGame)
        }
    };

    private void SelectGame(GameInfo game)
    {
        selectedGame = game;
        StateHasChanged();
    }

    private void GoBack()
    {
        selectedGame = null;
        StateHasChanged();
    }
}

